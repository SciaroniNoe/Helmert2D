<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Helmert 2D</title>
  <link rel="icon" type="image/png" href="img/Logo1.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>

<body class="p-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Trasformazione Helmert 2D</h3>
    <button id="helmertInfoBtn" type="button" class="btn-unstyled" data-bs-toggle="modal"
      data-bs-target="#helmertInfoModal" aria-label="Informazioni">
      <img src="img/info.ico" alt="Informazioni" id="helmertInfoSvg">
    </button>
  </div>

  <!-- Modal informativo -->
  <div class="modal fade" id="helmertInfoModal" tabindex="-1" aria-labelledby="helmertInfoModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="helmertInfoModalLabel">Trasformazione Helmert 2D</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Chiudi"></button>
        </div>
        <div class="modal-body">
          <p>La trasformazione Helmert 2D è una trasformazione similare che permette di allineare due sistemi di
            coordinate grazie a due
            traslazioni, una rotazione ed eventualmente un fattore scala. Essa permette di trasformare un sistema locale
            in un sistema globale minimizzando gli scarti sui punti in comune senza alterare la geometria. Un quadrato
            rimarrà un quadrato.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="row mb-3">
    <div class="col">
      <h5>Coordinate nel sistema locale</h5>
      <textarea id="local" class="form-control" rows="6" placeholder="No,E,N,H,Codice"></textarea>
    </div>
    <div class="col">
      <h5>Coordinate nel sistema globale</h5>
      <div class="d-flex">
        <textarea id="global" class="form-control me-2" rows="6" placeholder="No,E,N,H,Codice"></textarea>
        <button id="loadFile" class="btn btn-secondary btn-light-custom">Trova da file</button>
      </div>
    </div>
  </div>


  <!-- Bottoni -->
  <button id="findCommon" class="btn btn-primary mb-5">Trova punti in comune</button>

  <!-- Tabella punti in comune -->
  <div id="commonPointsSection" class="row" style="display:none;">
    <div class="col-md-4">
      <h5>Punti in comune</h5>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>N.</th>
            <th>Punto</th>
            <th>Usa</th>
          </tr>
        </thead>
        <tbody id="commonPoints"></tbody>
      </table>

      <!-- Messaggio numero punti -->
      <div id="commonPointsMsg" class="mb-3"></div>

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="calcScale" checked>
        <label class="form-check-label" for="calcScale">
          Calcolare il fattore di scala
        </label>
      </div>
      <!-- chart moved to results (render after transform) -->
    </div>
  </div>

  <button id="transform" class="btn btn-primary mb-5" style="display:none;">Esegui trasformazione</button>

  <!-- Risultati -->
  <div id="results" style="display:none;">
    <div class="row">
      <div class="col">
        <h5>Parametri di trasformazione</h5>
  <table id="paramsTable" class="table table-bordered mb-5">
          <thead>
            <tr>
              <th>Parametro</th>
              <th>Valore</th>
            </tr>
          </thead>
          <tbody id="params"></tbody>
        </table>
      </div>
      <div class="col">
        <h5>Residui sui punti in comune</h5>
        <table class="table table-bordered mb-5">
          <thead>
            <tr>
              <th>N.</th>
              <th>Punto</th>
              <th>ΔE [m]</th>
              <th>ΔN [m]</th>
              <th>Norma [m]</th>
            </tr>
          </thead>
          <tbody id="transformed"></tbody>
        </table>
      </div>
    </div>

    <div id="exportChartSection" class="mt-2 mb-5" style="display:none;">
      <h5 class="mb-2">Ripartizione dei punti</h5>
      <canvas id="exportChart" width="800" height="500" class="d-block mb-4" style="border:1px solid #e6e6e6; background:#fff; max-width:100%;"></canvas>
    </div>

    <h5>Coordinate nuovi punti</h5>
    <div class="row mb-5">
      <div class="col-md-6">
        <textarea id="newPoints" class="form-control" rows="6" readonly></textarea>
      </div>
      <div class="col-md-6"></div> <!-- metà pagina vuota -->
    </div>


    <h5>Esporta file</h5>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="expLocal">
      <label class="form-check-label" for="expLocal">Punti nel sistema locale</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="expGlobal">
      <label class="form-check-label" for="expGlobal">Punti nel sistema globale</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="expNuovi">
      <label class="form-check-label" for="expNuovi">Nuovi punti nel sistema globale</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" id="expReport">
      <label class="form-check-label" for="expReport">Report PDF</label>
    </div>
    <button id="export" class="btn btn-secondary mt-2">Esporta</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="js/script.js"></script>
</body>

</html>